const axios = require('axios');
const {Validator} = require('jsonschema');
const postOzJsonSchema = require('../testData/postOz.v1.json');

const validator = new Validator();

describe ('API POST tests', function() {
  let result;
  beforeEach(async () => {
    result = await axios.post('https://oz.by/books/more10684747.html', {
      "success": "1",
      "html": "<!--Comment-->\n<div itemprop=\"review\" itemscope itemtype=\"https://schema.org/Review\" class=\"rm-review b-comment\" data-review-id=\"576699\" data-review-level=\"0\" id=\"review_576699_0\">\n        <div class=\"b-comment__group\">\n        <!--Comment: primary-->\n        <div class=\"b-comment__primary\">\n            <div class=\"b-comment__primary-headline\">\n                                    <!--Comment: rating-->\n                    <div class=\"b-comment__primary-row b-comment__primary-row_rating\" itemprop=\"reviewRating\" itemscope itemtype=\"https://schema.org/Rating\">\n                        <meta itemprop=\"ratingValue\" content=\"4\">\n                        <div title=\"4/5\" class=\"b-comment__rating b-comment__rating_4\">\n                        </div>\n                    </div>\n                    <!--Comment: rating END-->\n                \n                <!--User-->\n                <div class=\"b-comment__complementary b-comment__complementary_a\">\n                    <div class=\"b-comment__complementary-row\">\n                                                    <a href=\"/personal/whoiswho.phtml?id=15947699\" itemprop=\"author\" itemscope itemtype=\"https://schema.org/Person\" class=\"b-comment__user\">\n                              <span class=\"b-comment__user-pic\">\n                                  <img src=\"\" width=\"40\" height=\"40\" alt=\"ozGerce\" class=\"b-comment__user-img\">\n                              </span>\n                                <span itemprop=\"name\" class=\"b-comment__user-name\">ozGerce</span>\n                            </a>\n                                                <div class=\"b-comment__date\"><meta itemprop=\"datePublished\" content=\"2023-06-20\">20 июня 2023</div>\n                                                                    </div>\n                </div>\n                <!--User END-->\n\n                                    <!-- Likes-->\n                    <div class=\"b-comment__complementary b-comment__complementary_b\">\n                        <div class=\"b-comment__complementary-row\">\n                            <div class=\"rm-review-vote-block b-comment-likes\">\n                                <ul class=\"b-comment-likes__list\">\n                                    <li class=\"b-comment-likes__item b-comment-likes__item_counter\">\n                                        <div class=\"rm-review-rating-block b-comment-likes__counter i-button i-button_counter i-button_small\">\n                                            +3                                        </div>\n                                    </li>\n                                                                        <li class=\"b-comment-likes__item b-comment-likes__item_tip\">\n                                        Полезный отзыв!\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                    <!-- Likes END-->\n                            </div>\n\n            <!--Comment: text-->\n            <div class=\"b-comment__primary-row\">\n                <div itemprop=\"text\" class=\"b-comment__body\">\n                    <p>книга не воодушевляющая уже с начала (по крайней мере для меня). но мне интересно было её читать дальше только потому, что у меня есть схожие мысли с рассказчиком этой книги. как говорится (в прочем, это и есть донесение самой книги), у каждого своё есть приключение, которое предстоит пройти самому. а книга всего лишь этому аргумент! наверное, вопрос \"почему вы здесь?\" задан для каждого индивидуально. спро́сите себя и кто-то ответит, что: семья и дети, стать известным, сделать для себя состояние, а возможно и просто пожить, и так далее. у всех по-разному! об этом можно толковать извечно, но это мнение должно быть всегда только при себе. другим на других будет всё равно, потому что чья-то жизнь не принадлежит кому-то ещё.</p>                </div>\n                <div class=\"rm-review-form-edit-block b-comment__editing\"></div>\n            </div>\n\n            <!-- Customer images -->\n            \n                            <div class=\"b-comment__primary-row\">\n                    <div class=\"b-comment__state\"><a href='/personal/whoiswho.phtml?id=15947699'>ozGerce</a> редактировала отзыв 20 июня 2023                    </div>\n                </div>\n                        <!--Comment: text END-->\n\n                        \n            <!--Comment: replies-->\n            <div class=\"b-comment__primary-row b-comment__primary-row_replies\">\n                <div class=\"rm-review-list b-comment__replies\">\n                                    </div>\n            </div>\n            <!--Comment: replies END-->\n\n        </div>\n        <!--Comment: primary END-->\n    </div>\n</div>\n<!--Comment END-->\n<!--Comment-->\n<div itemprop=\"review\" itemscope itemtype=\"https://schema.org/Review\" class=\"rm-review b-comment\" data-review-id=\"555111\" data-review-level=\"0\" id=\"review_555111_0\">\n        <div class=\"b-comment__group\">\n        <!--Comment: primary-->\n        <div class=\"b-comment__primary\">\n            <div class=\"b-comment__primary-headline\">\n                                    <!--Comment: rating-->\n                    <div class=\"b-comment__primary-row b-comment__primary-row_rating\" itemprop=\"reviewRating\" itemscope itemtype=\"https://schema.org/Rating\">\n                        <meta itemprop=\"ratingValue\" content=\"4\">\n                        <div title=\"4/5\" class=\"b-comment__rating b-comment__rating_4\">\n                        </div>\n                    </div>\n                    <!--Comment: rating END-->\n                \n                <!--User-->\n                <div class=\"b-comment__complementary b-comment__complementary_a\">\n                    <div class=\"b-comment__complementary-row\">\n                                                    <a href=\"/personal/whoiswho.phtml?id=24202109\" itemprop=\"author\" itemscope itemtype=\"https://schema.org/Person\" class=\"b-comment__user\">\n                              <span class=\"b-comment__user-pic\">\n                                  <img src=\"\" width=\"40\" height=\"40\" alt=\"oz24202109\" class=\"b-comment__user-img\">\n                              </span>\n                                <span itemprop=\"name\" class=\"b-comment__user-name\">oz24202109</span>\n                            </a>\n                                                <div class=\"b-comment__date\"><meta itemprop=\"datePublished\" content=\"2023-02-05\">5 февраля 2023</div>\n                                                                    </div>\n                </div>\n                <!--User END-->\n\n                                    <!-- Likes-->\n                    <div class=\"b-comment__complementary b-comment__complementary_b\">\n                        <div class=\"b-comment__complementary-row\">\n                            <div class=\"rm-review-vote-block b-comment-likes\">\n                                <ul class=\"b-comment-likes__list\">\n                                    <li class=\"b-comment-likes__item b-comment-likes__item_counter\">\n                                        <div class=\"rm-review-rating-block b-comment-likes__counter i-button i-button_counter i-button_small\">\n                                            +2                                        </div>\n                                    </li>\n                                                                        <li class=\"b-comment-likes__item b-comment-likes__item_tip\">\n                                        Полезный отзыв!\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                    <!-- Likes END-->\n                            </div>\n\n            <!--Comment: text-->\n            <div class=\"b-comment__primary-row\">\n                <div itemprop=\"text\" class=\"b-comment__body\">\n                    <p>Неплохая книга. На разок.</p>                </div>\n                <div class=\"rm-review-form-edit-block b-comment__editing\"></div>\n            </div>\n\n            <!-- Customer images -->\n            \n                        <!--Comment: text END-->\n\n                        \n            <!--Comment: replies-->\n            <div class=\"b-comment__primary-row b-comment__primary-row_replies\">\n                <div class=\"rm-review-list b-comment__replies\">\n                                    </div>\n            </div>\n            <!--Comment: replies END-->\n\n        </div>\n        <!--Comment: primary END-->\n    </div>\n</div>\n<!--Comment END-->\n<!--Comment-->\n<div itemprop=\"review\" itemscope itemtype=\"https://schema.org/Review\" class=\"rm-review b-comment\" data-review-id=\"551206\" data-review-level=\"0\" id=\"review_551206_0\">\n        <div class=\"b-comment__group\">\n        <!--Comment: primary-->\n        <div class=\"b-comment__primary\">\n            <div class=\"b-comment__primary-headline\">\n                                    <!--Comment: rating-->\n                    <div class=\"b-comment__primary-row b-comment__primary-row_rating\" itemprop=\"reviewRating\" itemscope itemtype=\"https://schema.org/Rating\">\n                        <meta itemprop=\"ratingValue\" content=\"4\">\n                        <div title=\"4/5\" class=\"b-comment__rating b-comment__rating_4\">\n                        </div>\n                    </div>\n                    <!--Comment: rating END-->\n                \n                <!--User-->\n                <div class=\"b-comment__complementary b-comment__complementary_a\">\n                    <div class=\"b-comment__complementary-row\">\n                                                    <a href=\"/personal/whoiswho.phtml?id=22257435\" itemprop=\"author\" itemscope itemtype=\"https://schema.org/Person\" class=\"b-comment__user\">\n                              <span class=\"b-comment__user-pic\">\n                                  <img src=\"\" width=\"40\" height=\"40\" alt=\"oz22257435\" class=\"b-comment__user-img\">\n                              </span>\n                                <span itemprop=\"name\" class=\"b-comment__user-name\">oz22257435</span>\n                            </a>\n                                                <div class=\"b-comment__date\"><meta itemprop=\"datePublished\" content=\"2023-01-16\">16 января 2023</div>\n                                                                    </div>\n                </div>\n                <!--User END-->\n\n                                    <!-- Likes-->\n                    <div class=\"b-comment__complementary b-comment__complementary_b\">\n                        <div class=\"b-comment__complementary-row\">\n                            <div class=\"rm-review-vote-block b-comment-likes\">\n                                <ul class=\"b-comment-likes__list\">\n                                    <li class=\"b-comment-likes__item b-comment-likes__item_counter\">\n                                        <div class=\"rm-review-rating-block b-comment-likes__counter i-button i-button_counter i-button_small\">\n                                            +2                                        </div>\n                                    </li>\n                                                                        <li class=\"b-comment-likes__item b-comment-likes__item_tip\">\n                                        Полезный отзыв!\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                    <!-- Likes END-->\n                            </div>\n\n            <!--Comment: text-->\n            <div class=\"b-comment__primary-row\">\n                <div itemprop=\"text\" class=\"b-comment__body\">\n                    <p>книга просто вау !! как и все к Стрелеки)</p><p>кажется, настолько простой вопрос «почему вы здесь ?», но очень сложно на него ответить и прийти к нему. благодаря нашему герою мы вместе с ним рассуждаем и ищем ответы</p>                </div>\n                <div class=\"rm-review-form-edit-block b-comment__editing\"></div>\n            </div>\n\n            <!-- Customer images -->\n            \n                        <!--Comment: text END-->\n\n                        \n            <!--Comment: replies-->\n            <div class=\"b-comment__primary-row b-comment__primary-row_replies\">\n                <div class=\"rm-review-list b-comment__replies\">\n                                    </div>\n            </div>\n            <!--Comment: replies END-->\n\n        </div>\n        <!--Comment: primary END-->\n    </div>\n</div>\n<!--Comment END-->\n<!--Comment-->\n<div itemprop=\"review\" itemscope itemtype=\"https://schema.org/Review\" class=\"rm-review b-comment\" data-review-id=\"292303\" data-review-level=\"0\" id=\"review_292303_0\">\n        <div class=\"b-comment__group\">\n        <!--Comment: primary-->\n        <div class=\"b-comment__primary\">\n            <div class=\"b-comment__primary-headline\">\n                                    <!--Comment: rating-->\n                    <div class=\"b-comment__primary-row b-comment__primary-row_rating\" itemprop=\"reviewRating\" itemscope itemtype=\"https://schema.org/Rating\">\n                        <meta itemprop=\"ratingValue\" content=\"4\">\n                        <div title=\"4/5\" class=\"b-comment__rating b-comment__rating_4\">\n                        </div>\n                    </div>\n                    <!--Comment: rating END-->\n                \n                <!--User-->\n                <div class=\"b-comment__complementary b-comment__complementary_a\">\n                    <div class=\"b-comment__complementary-row\">\n                                                    <a href=\"/personal/whoiswho.phtml?id=9222499\" itemprop=\"author\" itemscope itemtype=\"https://schema.org/Person\" class=\"b-comment__user\">\n                              <span class=\"b-comment__user-pic\">\n                                  <img src=\"\" width=\"40\" height=\"40\" alt=\"oz9222499\" class=\"b-comment__user-img\">\n                              </span>\n                                <span itemprop=\"name\" class=\"b-comment__user-name\">oz9222499</span>\n                            </a>\n                                                <div class=\"b-comment__date\"><meta itemprop=\"datePublished\" content=\"2018-11-04\">4 ноября 2018</div>\n                                                                    </div>\n                </div>\n                <!--User END-->\n\n                                    <!-- Likes-->\n                    <div class=\"b-comment__complementary b-comment__complementary_b\">\n                        <div class=\"b-comment__complementary-row\">\n                            <div class=\"rm-review-vote-block b-comment-likes\">\n                                <ul class=\"b-comment-likes__list\">\n                                    <li class=\"b-comment-likes__item b-comment-likes__item_counter\">\n                                        <div class=\"rm-review-rating-block b-comment-likes__counter i-button i-button_counter i-button_small\">\n                                            +2                                        </div>\n                                    </li>\n                                                                        <li class=\"b-comment-likes__item b-comment-likes__item_tip\">\n                                        Полезный отзыв!\n                                    </li>\n                                </ul>\n                            </div>\n                        </div>\n                    </div>\n                    <!-- Likes END-->\n                            </div>\n\n            <!--Comment: text-->\n            <div class=\"b-comment__primary-row\">\n                <div itemprop=\"text\" class=\"b-comment__body\">\n                    <p>Книга маленькая, читается за вечер, но</p><p> даже не смотря на интересное содержание (местами), по моему мнению - стоимость завышена. Прости OZ ;)</p>                </div>\n                <div class=\"rm-review-form-edit-block b-comment__editing\"></div>\n            </div>\n\n            <!-- Customer images -->\n            \n                        <!--Comment: text END-->\n\n                        \n            <!--Comment: replies-->\n            <div class=\"b-comment__primary-row b-comment__primary-row_replies\">\n                <div class=\"rm-review-list b-comment__replies\">\n                                    </div>\n            </div>\n            <!--Comment: replies END-->\n\n        </div>\n        <!--Comment: primary END-->\n    </div>\n</div>\n<!--Comment END-->\n",
      "more": "",
      "total": "4"
    },
    {
      headers: {
        'accept': 'application/json, text/javascript, */*; q=0.01',
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
      }
    })
    });

  test('POST https://oz.by/books/more10684747.html should be status 200', async () => {
    expect(result.status).toEqual(200);
  });

  test('POST https://oz.by/books/more10684747.html should be valid jsonschema', async () => {
    // const validationResult = await validator.validate(result.data, postOzJsonSchema)
    expect(result.data).toBeValidSchema(postOzJsonSchema);
  })
  });